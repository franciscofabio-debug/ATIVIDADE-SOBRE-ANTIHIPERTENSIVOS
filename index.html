<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliação de Farmacologia</title>
    <style>
        :root {
            --primary-color: #4a148c;
            --light-primary: #e9e3f5;
            --secondary-color: #673ab7;
            --correct-color: #2e7d32;
            --incorrect-color: #c62828;
            --neutral-color: #e0e0e0;
            --background-color: #f0f2f5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--background-color);
            color: #333;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px 0;
        }
        .app-container {
            width: 100%;
            max-width: 800px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Cabeçalho */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .app-header img {
            height: 40px;
        }
        .app-header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        
        .content-padding {
            padding: 30px;
        }

        /* Tela de Informações do Aluno */
        #student-info-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        #student-info-form input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        #start-btn {
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #start-btn:hover {
            opacity: 0.9;
        }

        /* Tela do Quiz */
        #quiz-wrapper {
            display: none;
        }

        #status-bar {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        #student-display, #score-tracker {
            background-color: #f4f4f9;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        #timeline-container {
            display: flex; flex-wrap: wrap; gap: 5px;
            margin-bottom: 25px; justify-content: center;
        }
        .timeline-item {
            width: 22px; height: 8px;
            background-color: var(--neutral-color);
            border-radius: 4px; transition: background-color 0.3s;
        }
        .timeline-item.correct { background-color: var(--correct-color); }
        .timeline-item.incorrect { background-color: var(--incorrect-color); }
        .timeline-item.current {
            transform: scale(1.3);
            box-shadow: 0 0 8px rgba(74, 20, 140, 0.5);
        }

        #question-container { min-height: 250px; }
        #question-text {
            font-size: 1.2em; font-weight: bold;
            margin-bottom: 20px; color: var(--primary-color);
        }
        .options label {
            display: block; background-color: #f9f9f9;
            padding: 12px 15px; margin-bottom: 10px;
            border-radius: 8px; cursor: pointer;
            transition: all 0.2s; border: 1px solid #ddd;
        }
        .options label:hover { background-color: var(--light-primary); }
        .options input[type="radio"] { display: none; }
        
        /* Estilos de Resposta */
        .options.answered label { cursor: not-allowed; opacity: 0.7; }
        .options.answered label:hover { background-color: #f9f9f9; }
        .options.answered label.correct-answer {
            background-color: #e8f5e9; border-color: var(--correct-color);
            color: var(--correct-color); font-weight: bold; opacity: 1;
        }
        .options.answered label.wrong-answer {
            background-color: #ffebee; border-color: var(--incorrect-color);
            color: var(--incorrect-color); font-weight: bold; opacity: 1;
        }

        #feedback-area {
            margin-top: 20px; padding: 15px; border-radius: 8px;
            font-weight: 500; display: none;
        }
        #feedback-area.correct { background-color: #e8f5e9; color: var(--correct-color); }
        #feedback-area.incorrect { background-color: #ffebee; color: var(--incorrect-color); }

        #navigation {
            margin-top: 30px; border-top: 1px solid #eee;
            padding-top: 20px; display: flex; justify-content: space-between;
        }
        .nav-btn {
            padding: 12px 25px; font-size: 1em; font-weight: bold;
            color: #fff; background-color: var(--secondary-color);
            border: none; border-radius: 5px; cursor: pointer;
        }
        .nav-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Tela Final */
        #results {
            text-align: center;
        }
         #whatsapp-btn {
            display: inline-block; padding: 12px 25px; font-size: 1.1em;
            color: #fff; background-color: #25D366; border-radius: 25px;
            text-decoration: none; margin-top: 20px; font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <img src="https://www.ufpb.br/ufpb/contents/imagens/brasao.png" alt="Logo UFPB">
            <h1>Avaliação de Farmacologia</h1>
        </header>

        <div id="student-info" class="content-padding">
            <h2>Bem-vindo(a)!</h2>
            <p>Por favor, preencha seus dados para iniciar a avaliação.</p>
            <form id="student-info-form">
                <input type="text" id="student-name" placeholder="Digite seu nome completo" required>
                <input type="text" id="student-id" placeholder="Digite sua matrícula" required>
                <button type="button" id="start-btn">Iniciar Avaliação</button>
            </form>
        </div>

        <div id="quiz-wrapper" class="content-padding">
             <div id="status-bar">
                <div id="student-display"></div>
                <div id="score-tracker">Acertos: 0 / 30</div>
             </div>
             <div id="timeline-container"></div>
             <div id="question-container">
                <p id="question-text"></p>
                <div class="options" id="options-container"></div>
             </div>
             <div id="feedback-area"></div>
             <div id="navigation">
                 <button id="prev-btn" class="nav-btn">Anterior</button>
                 <button id="next-btn" class="nav-btn">Próxima</button>
             </div>
        </div>

        <div id="results" class="content-padding" style="display:none;"></div>
    </div>

    <script>
        const quizData = [
            // ... (Os 30 objetos de questões que você forneceu, sem alterações) ...
            // Para economizar espaço, o array não será repetido aqui. O código JS abaixo assume que ele está aqui.
            { question: "1. A hipertensão é definida como:", options: ["PAS ≥ 120 mmHg e PAD ≥ 80 mmHg", "PAS > 140 mmHg e/ou PAD > 90 mmHg", "PAS > 130 mmHg e PAD > 85 mmHg", "PAS ≥ 160 mmHg e PAD ≥ 100 mmHg"], answer: "PAS > 140 mmHg e/ou PAD > 90 mmHg" },
            { question: "2. Qual é a principal alteração fisiológica responsável pela hipertensão?", options: ["Diminuição do volume plasmático", "Aumento da resistência vascular periférica", "Aumento do débito cardíaco", "Redução da contratilidade miocárdica"], answer: "Aumento da resistência vascular periférica" },
            { question: "3. Qual das afirmativas sobre a hipertensão é verdadeira?", options: ["Sempre tem uma causa conhecida", "Acomete apenas idosos", "É fator de risco para insuficiência renal e cardíaca", "Raramente leva a complicação se não tratada"], answer: "É fator de risco para insuficiência renal e cardíaca" },
            { question: "4. A adesão ao tratamento anti-hipertensivo é frequentemente baixa porque:", options: ["Os medicamentos são caros", "Os pacientes sentem dor intensa", "A hipertensão é sintomática", "O tratamento visa prevenir complicações futuras, não sintomas presentes"], answer: "O tratamento visa prevenir complicações futuras, não sintomas presentes" },
            { question: "5. Um efeito adverso dos β-bloqueadores que pode comprometer a adesão do paciente é:", options: ["Hiperglicemia", "Hipotireoidismo", "Disfunção sexual", "Constipação"], answer: "Disfunção sexual" },
            { question: "6. Qual o principal mecanismo de ação dos diuréticos no tratamento inicial da hipertensão?", options: ["Inibição da aldosterona", "Vasodilatação reflexa", "Redução do volume extracelular", "Aumento da contratilidade cardíaca"], answer: "Redução do volume extracelular" },
            { question: "7. Sobre os diuréticos tiazídicos, é incorreto afirmar:", options: ["São úteis em pacientes com função renal preservada", "Podem causar hipopotassemia", "Diminuem o cálcio urinário", "São eficazes mesmo em pacientes com VFG < 30 mL/min"], answer: "São eficazes mesmo em pacientes com VFG < 30 mL/min" },
            { question: "8. Os diuréticos de alça são preferidos em:", options: ["Hipertensão sem comorbidades", "Pacientes com edema e insuficiência cardíaca", "Hipertensão leve", "Hipertensão gestacional"], answer: "Pacientes com edema e insuficiência cardíaca" },
            { question: "9. Qual o efeito adverso que difere os diuréticos de alça dos tiazídicos?", options: ["Hipopotassemia", "Hiperuricemia", "Aumento da calciúria", "Hiperglicemia"], answer: "Aumento da calciúria" },
            { question: "10. Qual das opções abaixo é um diurético poupador de potássio?", options: ["Furosemida", "Hidroclorotiazida", "Espironolactona", "Clortalidona"], answer: "Espironolactona" },
            { question: "11. Qual classe de fármacos reduz a pós-carga por bloqueio de receptores α1?", options: ["β-bloqueadores", "Antagonistas do cálcio", "Bloqueadores α1-adrenérgicos", "Diuréticos"], answer: "Bloqueadores α1-adrenérgicos" },
            { question: "12. A clonidina é um agente anti-hipertensivo que atua:", options: ["Inibindo a ECA", "Aumentando a liberação de noradrenalina", "Como agonista α2-central", "Bloqueando canais de cálcio"], answer: "Como agonista α2-central" },
            { question: "13. Qual o principal efeito dos IECAs?", options: ["Inibição da secreção de aldosterona", "Estímulo da renina", "Inibição da conversão de angiotensina I em angiotensina II", "Estímulo da produção de angiotensina II"], answer: "Inibição da conversão de angiotensina I em angiotensina II" },
            { question: "14. Um efeito adverso comum dos IECAs é:", options: ["Hipocalemia", "Tosse seca", "Bradicardia", "Constipação"], answer: "Tosse seca" },
            { question: "15. Os BRA (bloqueadores dos receptores da angiotensina II) são indicados para:", options: ["Pacientes que não toleram os IECAs", "Gestantes", "Crianças com hipertensão", "Uso em crises hipertensivas agudas"], answer: "Pacientes que não toleram os IECAs" },
            { question: "16. Qual é a contraindicação clássica do uso de IECAs e BRAs?", options: ["Hiperglicemia", "Hipocalcemia", "Gravidez", "Hipotensão ortostática leve"], answer: "Gravidez" },
            { question: "17. Qual o mecanismo dos bloqueadores dos canais de cálcio?", options: ["Inibição da aldosterona", "Vasodilatação por redução do influxo de cálcio nos miócitos", "Aumento da frequência cardíaca", "Inibição dos receptores β1"], answer: "Vasodilatação por redução do influxo de cálcio nos miócitos" },
            { question: "18. Qual dos seguintes bloqueadores dos canais de cálcio atua preferencialmente sobre o coração?", options: ["Nifedipina", "Anlodipino", "Verapamil", "Amlodipina"], answer: "Verapamil" },
            { question: "19. Um efeito adverso comum dos antagonistas do cálcio diidropiridínicos é:", options: ["Bradicardia", "Edema periférico", "Constipação", "Hipocalemia"], answer: "Edema periférico" },
            { question: "20. Qual a principal indicação clínica dos β-bloqueadores na hipertensão?", options: ["Redução do débito cardíaco", "Estímulo da vasoconstrição", "Bloqueio da aldosterona", "Aumento do volume plasmático"], answer: "Redução do débito cardíaco" },
            { question: "21. Em qual condição os β-bloqueadores são particularmente úteis?", options: ["Diabetes mellitus", "Asma", "Insuficiência cardíaca com fração de ejeção reduzida", "Doença renal crônica"], answer: "Insuficiência cardíaca com fração de ejeção reduzida" },
            { question: "22. Qual medicamento anti-hipertensivo deve ser evitado em pacientes com asma?", options: ["Verapamil", "Espironolactona", "Propranolol", "Losartana"], answer: "Propranolol" },
            { question: "23. Os vasodilatadores diretos como hidralazina e minoxidil atuam principalmente sobre:", options: ["Arteríolas", "Vênulas", "Coração", "SNC"], answer: "Arteríolas" },
            { question: "24. A hidralazina pode causar um efeito adverso imunológico conhecido como:", options: ["Lúpus-like", "Eritema multiforme", "Síndrome de Stevens-Johnson", "Hepatite autoimune"], answer: "Lúpus-like" },
            { question: "25. Os nitratos são usados em:", options: ["Hipertensão pulmonar", "Angina de peito", "Hipertensão intracraniana", "Asma"], answer: "Angina de peito" },
            { question: "26. Qual combinação de fármacos anti-hipertensivos é geralmente segura?", options: ["IECAs + BRAs", "Diuréticos + IECAs", "β-bloqueadores + bloqueadores dos canais de cálcio cardíacos", "BRA + bloqueador α1"], answer: "Diuréticos + IECAs" },
            { question: "27. Qual das seguintes drogas anti-hipertensivas deve ser evitada na gravidez?", options: ["Metildopa", "Nifedipina", "Losartana", "Hidralazina"], answer: "Losartana" },
            { question: "28. A metildopa é segura para uso em:", options: ["Idosos com insuficiência renal", "Crianças", "Gestantes", "Pacientes com doença hepática"], answer: "Gestantes" },
            { question: "29. A hipertensão secundária pode ser causada por:", options: ["Disfunção tireoidiana", "Uso crônico de estatinas", "Ingestão de potássio", "Exercício físico regular"], answer: "Disfunção tireoidiana" },
            { question: "30. Qual fármaco tem início de ação mais rápido em emergências hipertensivas?", options: ["Enalapril", "Hidralazina IV", "Espironolactona", "Atenolol"], answer: "Hidralazina IV" }

        ];
        
        // Elementos da DOM
        const studentInfoDiv = document.getElementById('student-info');
        const quizWrapperDiv = document.getElementById('quiz-wrapper');
        const startBtn = document.getElementById('start-btn');
        const studentNameInput = document.getElementById('student-name');
        const studentIdInput = document.getElementById('student-id');
        const studentDisplay = document.getElementById('student-display');
        const scoreTracker = document.getElementById('score-tracker');
        const timelineContainer = document.getElementById('timeline-container');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackArea = document.getElementById('feedback-area');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const resultsContainer = document.getElementById('results');

        const teacherPhoneNumber = '5584994420139';
        let studentName = '';
        let studentId = '';
        let currentQuestionIndex = 0;

        // Adiciona um campo para armazenar a resposta do usuário
        quizData.forEach(q => q.userAnswer = null);

        startBtn.addEventListener('click', () => {
            studentName = studentNameInput.value.trim();
            studentId = studentIdInput.value.trim();

            if (studentName === '' || studentId === '') {
                alert('Por favor, preencha seu nome e matrícula para continuar.');
                return;
            }

            studentInfoDiv.style.display = 'none';
            quizWrapperDiv.style.display = 'block';
            studentDisplay.innerText = studentName;
            
            createTimeline();
            renderQuestion(currentQuestionIndex);
        });

        function createTimeline() {
            quizData.forEach((_, index) => {
                const item = document.createElement('div');
                item.classList.add('timeline-item');
                item.id = `timeline-item-${index}`;
                timelineContainer.appendChild(item);
            });
        }
        
        function renderQuestion(index) {
            const question = quizData[index];
            questionText.innerText = question.question;
            optionsContainer.innerHTML = '';
            optionsContainer.className = 'options'; // Reseta a classe
            feedbackArea.style.display = 'none';

            // Atualiza a timeline para destacar a questão atual
            document.querySelectorAll('.timeline-item').forEach((item, i) => {
                item.classList.toggle('current', i === index);
            });
            
            question.options.forEach(option => {
                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question${index}`;
                input.value = option;
                input.onchange = () => handleAnswer(index, option, label);

                label.appendChild(input);
                label.append(option);
                optionsContainer.appendChild(label);
            });
            
            // Se a questão já foi respondida, renderiza no estado "respondido"
            if (question.userAnswer !== null) {
                handleAnswer(index, question.userAnswer, null, true);
            }

            updateNavigation();
        }

        function handleAnswer(index, selectedOption, selectedLabel, isReRender = false) {
            const question = quizData[index];
            const timelineItem = document.getElementById(`timeline-item-${index}`);

            if (!isReRender) {
                question.userAnswer = selectedOption;
                timelineItem.classList.remove('correct', 'incorrect');
                if (selectedOption === question.answer) {
                    timelineItem.classList.add('correct');
                } else {
                    timelineItem.classList.add('incorrect');
                }
                updateScore();
            }

            // Desabilita todos os inputs e aplica estilos de feedback
            optionsContainer.classList.add('answered');
            const allLabels = optionsContainer.querySelectorAll('label');
            allLabels.forEach(label => {
                const input = label.querySelector('input');
                input.disabled = true;

                if (input.value === question.answer) {
                    label.classList.add('correct-answer');
                }
                if (input.value === selectedOption && selectedOption !== question.answer) {
                    label.classList.add('wrong-answer');
                }
            });

            // Mostra o gabarito
            feedbackArea.style.display = 'block';
            if (question.userAnswer === question.answer) {
                feedbackArea.className = 'feedback-area correct';
                feedbackArea.innerHTML = '<strong>Resposta Correta!</strong>';
            } else {
                feedbackArea.className = 'feedback-area incorrect';
                feedbackArea.innerHTML = `<strong>Resposta Incorreta.</strong> A resposta correta é: <strong>${question.answer}</strong>`;
            }
        }
        
        function updateScore() {
            const correctAnswers = quizData.filter(q => q.userAnswer === q.answer).length;
            scoreTracker.innerText = `Acertos: ${correctAnswers} / ${quizData.length}`;
        }
        
        function updateNavigation() {
            prevBtn.disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.innerText = 'Finalizar Avaliação';
            } else {
                nextBtn.innerText = 'Próxima';
            }
        }

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion(currentQuestionIndex);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion(currentQuestionIndex);
            } else {
                // Finaliza o quiz
                finishQuiz();
            }
        });
        
        function finishQuiz() {
            const score = quizData.filter(q => q.userAnswer === q.answer).length;
            const totalQuestions = quizData.length;
            const percentage = ((score / totalQuestions) * 100).toFixed(1);

            quizWrapperDiv.style.display = 'none';
            resultsContainer.style.display = 'block';

            resultsContainer.innerHTML = `
                <h2>Avaliação Finalizada!</h2>
                <p>Aluno(a): <strong>${studentName}</strong></p>
                <p>Matrícula: <strong>${studentId}</strong></p>
                <p>Você acertou <strong>${score}</strong> de <strong>${totalQuestions}</strong> questões.</p>
                <p>Sua pontuação final é <strong>${percentage}%</strong>.</p>
                <a id="whatsapp-btn" href="#" target="_blank">Enviar Resultado para o Professor</a>
            `;

            const message = `*Avaliação de Farmacologia Concluída*\n\n*Aluno(a):* ${studentName}\n*Matrícula:* ${studentId}\n*Acertos:* ${score} de ${totalQuestions}\n*Pontuação:* ${percentage}%`;
            const whatsappURL = `https://api.whatsapp.com/send?phone=${teacherPhoneNumber}&text=${encodeURIComponent(message)}`;
            document.getElementById('whatsapp-btn').href = whatsappURL;
        }

    </script>
</body>
</html>
